#!/bin/bash

#
# Publish a pdf to my webserver. Assumes passwordless ssh access to server.
#
# Usage: publish [resume.pdf]
#

resume=$1
host=benjaminran.com
user=ubuntu
remote_dir=/home/ubuntu/public_html/resume

if [ "${resume}" = "" ]; then resume=`dirname $0`/../output/resume.pdf; fi

# Determine remote filename to use
name=`date +resume-%m.%d.%Y`
suffix=1

while true; do
    if ssh ${user}@${host} stat ${remote_dir}/${name}-${suffix}.pdf \> /dev/null 2\>\&1
    then
        let suffix++
    else
        break
    fi
done
remote_filename=${name}-${suffix}.pdf

# Upload file
scp ${resume} ${user}@${host}:${remote_dir}/${remote_filename}
ssh ${user}@${host} ln -f -s ${remote_dir}/${remote_filename} ${remote_dir}/benjaminran-latest.pdf
